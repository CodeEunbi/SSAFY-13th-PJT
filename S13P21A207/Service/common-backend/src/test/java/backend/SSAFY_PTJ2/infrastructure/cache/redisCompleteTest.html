<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>í†µí•© ì„¤ì • í…ŒìŠ¤íŠ¸</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <h1>í†µí•© ì„¤ì • í…ŒìŠ¤íŠ¸</h1>
    
    <div>
        <h3>ì—°ê²° ìƒíƒœ: <span id="status">ì—°ê²° ì•ˆë¨</span></h3>
        <button onclick="connect()">ì—°ê²°</button>
        <button onclick="disconnect()">ì—°ê²° í•´ì œ</button>
    </div>
    
    <button onclick="sendSettings()">ì„¤ì • ì „ì†¡</button>
    
    <div>
        <h3>ë¡œê·¸</h3>
        <pre id="log" style="border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: scroll;"></pre>
    </div>

    <script>
        let socket = null;

        function log(message) {
            const logEl = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logEl.textContent += `[${timestamp}] ${message}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        }

        function connect() {
            socket = io('http://localhost:9092');
            
            socket.on('connect', () => {
                document.getElementById('status').textContent = 'âœ… ì—°ê²°ë¨';
                log('âœ… Socket.IO ì—°ê²° ì„±ê³µ: ' + socket.id);
            });
            
            socket.on('disconnect', () => {
                document.getElementById('status').textContent = 'âŒ ì—°ê²° ì•ˆë¨';
                log('âŒ ì—°ê²° ì¢…ë£Œ');
            });
            
            socket.on('settings-saved', (response) => {
                log('âœ… ì„¤ì • ì €ì¥ ì™„ë£Œ: ' + JSON.stringify(response));
            });
            
            socket.on('error', (error) => {
                log('âŒ ì—ëŸ¬: ' + JSON.stringify(error));
            });
        }

        function disconnect() {
            if (socket) {
                socket.disconnect();
                socket = null;
            }
        }

        function sendSettings() {
            if (!socket || !socket.connected) {
                alert('Socket.IOê°€ ì—°ê²°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤!');
                return;
            }
            
            const settings = {
                "type": "settingsDoc",
                "settings": {
                    "serviceEnabled": true,
                    "showIcon": true,
                    "filteringEnabled": true,
                    "filterImage": {
                        "enabled": true,
                        "originalViewEnabled": false,
                        "categories": ["CRIME", "HORROR"]
                    },
                    "filterText": {
                        "enabled": true,
                        "originalViewEnabled": true,
                        "categories": ["POLITICS"]
                    }
                },
                "__meta": {
                    "updatedAt": new Date().toISOString()
                }
            };
            
            log('ğŸ“¤ ì „ì†¡: ' + JSON.stringify(settings, null, 2));
            socket.emit('user-settings', settings);
        }
    </script>
</body>
</html>